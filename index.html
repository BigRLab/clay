<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.6.6" />
<title>Clay Framework</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }


/*
 * xhtml11 specific
 *
 * */

tt {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

.monospaced {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Clay Framework</h1>
<span id="author">Jeremy Grosser</span><br />
<span id="email"><tt>&lt;<a href="mailto:jeremy@uber.com">jeremy@uber.com</a>&gt;</tt></span><br />
<span id="revnumber">version 2.0.5,</span>
<span id="revdate">2013-10-24</span>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>Clay is a framework for building RESTful backend services using best practices. It&#8217;s a wrapper around Flask (<a href="http://flask.pocoo.org">http://flask.pocoo.org</a>) along with several convenient, standardized, performance enhanced ways of performing common tasks like sending email and connecting to a database. Clay is available under the MIT License.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_getting_started">Getting Started</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_writing_a_new_service">Writing a new service</h3>
<div class="paragraph"><p>If you&#8217;re developing a new service, you&#8217;ve come to the right place. Let&#8217;s start with the obligatory Hello World. You&#8217;ll notice that this is very similar to <a href="http://flask.pocoo.org/docs/quickstart/#a-minimal-application">Flask&#8217;s Hello World example</a>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-style: italic"><span style="color: #9A1900"># This is a minimalist example of a clay view. Run it like so:</span></span>
<span style="font-style: italic"><span style="color: #9A1900">#</span></span>
<span style="font-style: italic"><span style="color: #9A1900">#   CLAY_CONFIG=simple-clay.conf clay-devserver</span></span>
<span style="font-style: italic"><span style="color: #9A1900">#</span></span>
<span style="font-weight: bold"><span style="color: #000080">from</span></span> __future__ <span style="font-weight: bold"><span style="color: #000080">import</span></span> absolute_import
<span style="font-weight: bold"><span style="color: #000080">from</span></span> clay <span style="font-weight: bold"><span style="color: #000080">import</span></span> app


@app<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">route</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'/'</span><span style="color: #990000">,</span> methods<span style="color: #990000">=[</span><span style="color: #FF0000">'GET'</span><span style="color: #990000">])</span>
<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">hello</span></span><span style="color: #990000">():</span>
<span style="font-style: italic"><span style="color: #9A1900">    '''</span></span>
<span style="font-style: italic"><span style="color: #9A1900">    Ensures that the world is still there.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">    '''</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">'Hello World!'</span></tt></pre></div></div>
<div class="paragraph"><p>A few noteworthy things here that begin our list of best practices&#8230;</p></div>
<div class="ulist"><ul>
<li>
<p>
Every module starts with <tt>from __future__ import absolute_import</tt>, this is to prevent large projects from ending up with cyclical imports.
</p>
</li>
<li>
<p>
Along those same lines, wildcard imports like <tt>from foo import *</tt> should <strong>never</strong> be used. <strong>Always</strong> explicitly list the things you&#8217;re importing from a module.
</p>
</li>
<li>
<p>
<tt>from</tt> imports should be avoided when practical. In the middle of a thousand-line file, it might not be obvious that <tt>mail.send(...)</tt> is really <tt>clay.mail.send(...)</tt> and not an instance of a local object.
</p>
</li>
<li>
<p>
Keep reasonably close to PEP8 recommendations. Four space tabs, two newlines between top-level definitions in a module, etc. If you like keeping things to 80 columns, that&#8217;s fine, but if a line needs to be longer, nobody&#8217;s going to complain.
</p>
</li>
<li>
<p>
Explicitly list the methods that a route responds to. We know that <tt>app.route()</tt> defaults to GET methods only, but this is not guaranteed to be the same in future versions of Flask/Clay.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Every Clay application needs a config. Clay configs are JSON files. The clay framework itself looks for a few config variables (TODO: see below). By default, we look for files listed in <tt>$CLAY_CONFIG</tt> delimited by colons <tt>:</tt> relative to the directory the development server runs from. Here&#8217;s a simple example.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">{</span>
        <span style="color: #FF0000">"debug"</span><span style="color: #990000">:</span> <span style="color: #FF0000">{</span>
                <span style="color: #FF0000">"enabled"</span><span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">,</span>
                <span style="color: #FF0000">"server"</span><span style="color: #990000">:</span> <span style="color: #FF0000">{</span>
                        <span style="color: #FF0000">"host"</span><span style="color: #990000">:</span> <span style="color: #FF0000">"127.0.0.1"</span><span style="color: #990000">,</span>
                        <span style="color: #FF0000">"port"</span><span style="color: #990000">:</span> <span style="color: #993399">8000</span>
                <span style="color: #FF0000">}</span>
        <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">"views"</span><span style="color: #990000">:</span> <span style="color: #990000">[</span><span style="color: #FF0000">"helloworld"</span><span style="color: #990000">]</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>This is the minimum configuration necessary to run the clay devserver. The first flask init section is the module name passed to the Flask app constructor. This is only used for uniquely identifying this application internally and has no bearing on anything important. It should follow the <a href="http://www.python.org/dev/peps/pep-0008/#package-and-module-names">naming rules</a> for Python modules. Here we use <tt>helloworldapp</tt> just to differentiate it from the name of our view module.</p></div>
<div class="paragraph"><p>The debug server section provides a host and port for the clay devserver to listen on. No magic here, just an IP and port. Use "0.0.0.0" for the host to listen on all interfaces.</p></div>
<div class="paragraph"><p><tt>views</tt> is a list of modules to be loaded when the server starts up. This allows you to run multiple view modules simultaneously without having to manage a file with a list of routes or prefixes.</p></div>
<div class="paragraph"><p>Now that we&#8217;ve got a view module and a config, we can run the clay devserver&#8230;</p></div>
</div>
<div class="sect2">
<h3 id="_running_the_development_server">Running the development server</h3>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">export</span></span> <span style="color: #009900">CLAY_CONFIG</span><span style="color: #990000">=.</span>/simple-clay<span style="color: #990000">.</span>conf
clay-devserver</tt></pre></div></div>
<div class="paragraph"><p><tt>CLAY_CONFIG</tt> is a colon delimited list of config files to be loaded, in order of precedence. For example, if <tt>CLAY_CONFIG=./common.conf:./janky.conf</tt>, the configuration dictionary from common.conf is loaded first, then update()'d with the dictionary from janky.conf.</p></div>
</div>
<div class="sect2">
<h3 id="_running_a_clay_service_in_production">Running a clay service in production</h3>
<div class="paragraph"><p>Clay exposes itself as a standard WSGI application in the module
clay.wsgi. The <tt>CLAY_CONFIG</tt> environment variable needs to be set.
All view modules listed in the config will be imported at startup.</p></div>
<div class="listingblock">
<div class="title">Running a production clay service with gunicorn</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">export</span></span> <span style="color: #009900">CLAY_CONFIG</span><span style="color: #990000">=.</span>/simple-clay<span style="color: #990000">.</span>conf
gunicorn clay<span style="color: #990000">.</span>wsgi<span style="color: #990000">:</span>application</tt></pre></div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_api_reference">API Reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_clay_config">clay.config</h3>
<div class="paragraph"><p>The <tt>clay.config</tt> module provides a simple API for accessing
configuration information. Internally, all Clay modules use this
module to configure themselves.</p></div>
<div class="paragraph"><p>Upon import, clay.config attempts to load it&#8217;s configuration from
files listed in the <tt>CLAY_CONFIG</tt> environment variable, delimited by
colons. Each file&#8217;s name is examined for a known file extension and
parsed by the appropriate deserializer. Currently json is supported
using the standard library and yaml is supported if PyYAML is
installed. As each file is parsed, it is applied to the global config
with <tt>dict.update()</tt>.</p></div>
<div class="paragraph"><p>This module registers itself as a handler for SIGHUP and will attempt to reload it&#8217;s configuration upon receiving that signal. The configuration may also be reloaded on demand by calling <tt>config.load()</tt>.</p></div>
<div class="paragraph"><p>Several methods are exposed at the top level of the clay.config module and are intended to provide the config&#8217;s public API.</p></div>
<div class="sect3">
<h4 id="_clay_config_get_key_default_none">clay.config.get(key, default=None)</h4>
<div class="paragraph"><p><tt>key</tt> is a period <tt>.</tt> delimited string that is recursively searched for a configuration option with that name. If this lookup fails at any level of the config hierarchy, the value of <tt>default</tt> is returned. For example, you can expect the following behavior for the given config.</p></div>
<div class="listingblock">
<div class="title">Example configuration</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">{</span>
    <span style="color: #FF0000">"users"</span><span style="color: #990000">:</span> <span style="color: #FF0000">{</span>
        <span style="color: #FF0000">"admins"</span><span style="color: #990000">:</span> <span style="color: #990000">[</span><span style="color: #FF0000">"synack"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"bigo"</span><span style="color: #990000">]</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&gt;&gt;&gt;</span> <span style="font-weight: bold"><span style="color: #000080">from</span></span> clay <span style="font-weight: bold"><span style="color: #000080">import</span></span> config
<span style="color: #990000">&gt;&gt;&gt;</span> config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'users.admins'</span><span style="color: #990000">)</span>
<span style="color: #990000">[</span>u<span style="color: #FF0000">"synack"</span><span style="color: #990000">,</span> u<span style="color: #FF0000">"bigo"</span><span style="color: #990000">]</span>
<span style="color: #990000">&gt;&gt;&gt;</span> config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'users.players'</span><span style="color: #990000">)</span>
None
<span style="color: #990000">&gt;&gt;&gt;</span> config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'dogs'</span><span style="color: #990000">)</span>
None
<span style="color: #990000">&gt;&gt;&gt;</span> config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'dogs'</span><span style="color: #990000">,</span> default<span style="color: #990000">=</span>True<span style="color: #990000">)</span>
True</tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_clay_config_get_logger_name">clay.config.get_logger(name)</h4>
<div class="paragraph"><p>Returns a pre-configured <tt>logging.Logger</tt> instance identified by the given name. Depending on the framework&#8217;s environment, this logger may format and emit messages in different ways. In development, messages will be routed to the console whereas in production they might be routed to an aggregate endpoint or archive.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #990000">&gt;&gt;&gt;</span> <span style="font-weight: bold"><span style="color: #000080">from</span></span> clay<span style="color: #990000">.</span>config <span style="font-weight: bold"><span style="color: #000080">import</span></span> config
<span style="color: #990000">&gt;&gt;&gt;</span> log <span style="color: #990000">=</span> config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get_logger</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'myservice'</span><span style="color: #990000">)</span>
<span style="color: #990000">&gt;&gt;&gt;</span> log<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">debug</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'Now we know what\'s happening!'</span><span style="color: #990000">)</span>
myservice DEBUG Now we know what's happening<span style="color: #990000">!</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_clay_config_debug">clay.config.debug()</h4>
<div class="paragraph"><p>DEPRECATED, will be removed in a future release. Use
<tt>clay.config.get('debug.enabled', False)</tt> instead.</p></div>
</div>
<div class="sect3">
<h4 id="_clay_config_feature_flag_name">clay.config.feature_flag(name)</h4>
<div class="paragraph"><p>Similar to <tt>clay.config.get</tt>, feature_flag is specific to things with boolean values that enable or disable functionality within your service. This method returns True if the given feature is enabled, False otherwise.</p></div>
<div class="listingblock">
<div class="title">Example configuration</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">{</span>
    <span style="color: #FF0000">"features"</span><span style="color: #990000">:</span> <span style="color: #FF0000">{</span>
        <span style="color: #FF0000">"new_shiny_bits"</span><span style="color: #990000">:</span> <span style="color: #FF0000">{</span>
            <span style="color: #FF0000">"enabled"</span><span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span>
        <span style="color: #FF0000">}</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">"new_scary_thing"</span><span style="color: #990000">:</span> <span style="color: #FF0000">{</span>
            <span style="color: #FF0000">"enabled"</span><span style="color: #990000">:</span> <span style="font-weight: bold"><span style="color: #0000FF">true</span></span><span style="color: #990000">,</span>
            <span style="color: #FF0000">"percent"</span><span style="color: #990000">:</span> <span style="color: #993399">10.0</span>
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>In the example above, <tt>feature_flag('new_shiny_bits')</tt> would return True and <tt>feature_flag('new_scary_thing')</tt> will only return True 10% of the time. The percent option is useful for A/B testing new features or slowly rolling out a feature for a subset of requests to gauge performance.</p></div>
</div>
<div class="sect3">
<h4 id="_clay_config_load">clay.config.load()</h4>
<div class="paragraph"><p>This method will cause the configuration to be reloaded from it&#8217;s source on demand. <strong>WARNING</strong> if a syntax error or otherwise unreadable configuration is loaded, the process calling this method will be aborted immediately via sys.exit(), this is often not desirable.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_clay_mail">clay.mail</h3>
<div class="sect3">
<h4 id="_clay_mail_sendmail_mailto_subject_message_subtype_em_html_em_charset_em_utf_8_em_headers">clay.mail.sendmail(mailto, subject, message, subtype=<em>html</em>, charset=<em>utf-8</em>, **headers)</h4>
<div class="paragraph"><p>Sends an email to the given address using the server/credentials specified in the config under <tt>smtp</tt>.</p></div>
<div class="paragraph"><p>Additional SMTP headers may be set as keyword arguments, the values of which are expected to be either a subclass of basestring or an iterable of basestrings.</p></div>
<div class="paragraph"><p>By default the From address is populated by the <tt>smtp.from</tt> config option. This may be overridden by passing a <tt>From</tt> kwarg.</p></div>
<div class="listingblock">
<div class="title">Mail configuration</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">{</span>
    <span style="color: #FF0000">"smtp"</span><span style="color: #990000">:</span> <span style="color: #FF0000">{</span>
        <span style="color: #FF0000">"host"</span><span style="color: #990000">:</span> <span style="color: #FF0000">"smtp.example.com"</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">"port"</span><span style="color: #990000">:</span> <span style="color: #993399">25</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">"username"</span><span style="color: #990000">:</span> <span style="color: #FF0000">"myname"</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">"password"</span><span style="color: #990000">:</span> <span style="color: #FF0000">"superseekrit"</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">"from"</span><span style="color: #990000">:</span> <span style="color: #FF0000">"test@example.com"</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="listingblock">
<div class="title">Sending email</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">from</span></span> clay <span style="font-weight: bold"><span style="color: #000080">import</span></span> mail

<span style="font-style: italic"><span style="color: #9A1900"># Simple example</span></span>
mail<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">sendmail</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'user@example.com'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'Not spam I promise!'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'A simple example'</span><span style="color: #990000">)</span>

<span style="font-style: italic"><span style="color: #9A1900"># Complex example</span></span>
mail<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">sendmail</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'user@example.com'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'Definitely not spam'</span><span style="color: #990000">,</span> CC<span style="color: #990000">=[</span>
  <span style="color: #FF0000">'otheruser@example.com'</span><span style="color: #990000">,</span>
<span style="font-style: italic"><span style="color: #9A1900">  'somedude@otherexample.com'</span></span>
<span style="color: #990000">],</span> BCC<span style="color: #990000">=</span><span style="color: #FF0000">'outbound@example.com'</span><span style="color: #990000">,</span> From<span style="color: #990000">=</span><span style="color: #FF0000">'noreply@example.com'</span><span style="color: #990000">,</span> subtype<span style="color: #990000">=</span><span style="color: #FF0000">'html'</span><span style="color: #990000">,</span>
  message<span style="color: #990000">=</span><span style="color: #FF0000">'&lt;marquee&gt;&lt;blink&gt;YOU OBVIOUSLY LOVE OWLS&lt;/blink&gt;&lt;/marquee&gt;'</span><span style="color: #990000">)</span></tt></pre></div></div>
</div>
</div>
<div class="sect2">
<h3 id="_clay_http">clay.http</h3>
<div class="sect3">
<h4 id="_clay_http_request_method_uri_headers_data">clay.http.request(method, uri, headers, data)</h4>
<div class="paragraph"><p>Performs an HTTP request and returns a Response object (which is just
a namedtuple) with status, headers, and data attributes. This module
is just a wrapper around urllib2 so any installed openers or redirect
handlers will be used. See the urllib2 docs for more information
(<a href="http://docs.python.org/2/library/urllib2.html">http://docs.python.org/2/library/urllib2.html</a>).</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">from</span></span> clay <span style="font-weight: bold"><span style="color: #000080">import</span></span> http

response <span style="color: #990000">=</span> http<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">request</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'GET'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'http://httpbin.org/ip'</span><span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> response<span style="color: #990000">.</span>status <span style="color: #990000">!=</span> <span style="color: #993399">200</span><span style="color: #990000">:</span>
  <span style="font-weight: bold"><span style="color: #0000FF">print</span></span> <span style="color: #FF0000">'Something bad happened: '</span><span style="color: #990000">,</span> response<span style="color: #990000">.</span>data</tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_clay_http_cache_control_8230">clay.http.cache_control(&#8230;)</h4>
<div class="paragraph"><p>Decorator that adds a Cache-Control header to the response of a view
function. Each keyword argument to this decorator is appended to the
Cache-Control value, delimited by a comma. The key of each argument
has any underscore <tt>_</tt> characters replaced with dash <tt>-</tt>.</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">from</span></span> clay <span style="font-weight: bold"><span style="color: #000080">import</span></span> app<span style="color: #990000">,</span> http

@app<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">route</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'/hello_cache'</span><span style="color: #990000">,</span> methods<span style="color: #990000">=[</span><span style="color: #FF0000">'GET'</span><span style="color: #990000">]</span>
@http<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">cache_control</span></span><span style="color: #990000">(</span>max_age<span style="color: #990000">=</span><span style="color: #993399">3600</span><span style="color: #990000">,</span> public<span style="color: #990000">=</span>True<span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">hello_cache</span></span><span style="color: #990000">():</span>
  <span style="font-weight: bold"><span style="color: #0000FF">return</span></span> <span style="color: #FF0000">'Hi!'</span></tt></pre></div></div>
<div class="listingblock">
<div class="content"></div></div>
</div>
</div>
<div class="sect2">
<h3 id="_clay_docs">clay.docs</h3>
<div class="paragraph"><p>This module is not meant to be imported by an application, rather it
can be added to the views list in your app&#8217;s configuration to provide
a <tt>GET /_docs</tt> endpoint that parses the docstrings of all registered
routes and returns a JSON representation of your API&#8217;s documentation.</p></div>
<div class="sect3">
<h4 id="_docstring_format">Docstring Format</h4>
<div class="paragraph"><p>In order to provide enough metadata to generate documentation from
a route, a machine readable format must be defined for writing
docstrings. This module uses a format loosely based on Sphinx
httpdomain (<a href="http://pythonhosted.org/sphinxcontrib-httpdomain/">http://pythonhosted.org/sphinxcontrib-httpdomain/</a>).</p></div>
<div class="paragraph"><p>The first non-whitespace line of the docstring is assumed to be a
"short doc" or "summary" of the endpoint&#8217;s behavior. This SHOULD be
a human readable description of the endpoint less than 72 characters
long. Lines following the short doc are a longer human readable
description of the endpoint&#8217;s behavior.</p></div>
<div class="paragraph"><p>Any line beginning with a <tt>:</tt> character is split on <tt>:</tt> and assumed to
expand to a tuple of (directive, key, value).</p></div>
<div class="paragraph"><p>Within the value of a directive, if an opening <tt>{</tt> and closing <tt>}</tt>
brace are detected, the substring within the braces is parsed as a
JSON hash with additional metadata about this parameter. Currently
this is only used for specifying which parameters are required.</p></div>
<div class="paragraph"><p>The <tt>:rtype:</tt> directive is special, it does not require a key but
references a dict object by import name. This dict defines the fields
of a JSON response body in a format defined in JSON-Schema format
utilized by swagger.  (<a href="http://json-schema.org/">http://json-schema.org/</a>)
(<a href="https://github.com/wordnik/swagger-core/wiki/datatypes">https://github.com/wordnik/swagger-core/wiki/datatypes</a>)</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt>@app<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">route</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'/things/search'</span><span style="color: #990000">,</span> methods<span style="color: #990000">=[</span><span style="color: #FF0000">'GET'</span><span style="color: #990000">])</span>
<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">hello</span></span><span style="color: #990000">():</span>
<span style="font-style: italic"><span style="color: #9A1900">  '''</span></span>
<span style="font-style: italic"><span style="color: #9A1900">  Search for things</span></span>

<span style="font-style: italic"><span style="color: #9A1900">  This is an example of a search endpoint that takes query string</span></span>
<span style="font-style: italic"><span style="color: #9A1900">  parameters to limit the scope of the search.</span></span>

<span style="font-style: italic"><span style="color: #9A1900">  :query keywords: A whitespace delimited list of keywords to be included in the search. The implicit boolean AND is applied to all terms. {"required": true}</span></span>
<span style="font-style: italic"><span style="color: #9A1900">  :query limit: The number of results to return, if not specified 100 is assumed</span></span>
<span style="font-style: italic"><span style="color: #9A1900">  :status 200: Search completed, results are included in the response</span></span>
<span style="font-style: italic"><span style="color: #9A1900">  :status 400: Required parameter keywords was not specified or limit was not an integer</span></span>
<span style="font-style: italic"><span style="color: #9A1900">  :status 404: Search completed, but no results matched</span></span>
<span style="font-style: italic"><span style="color: #9A1900">  :rtype: things.protocol.SearchResults</span></span>
<span style="font-style: italic"><span style="color: #9A1900">  '''</span></span>
  <span style="font-style: italic"><span style="color: #9A1900"># TODO: implement searching things</span></span>
  <span style="font-weight: bold"><span style="color: #0000FF">pass</span></span>


SearchResults <span style="color: #990000">=</span> <span style="color: #990000">{</span>
  <span style="color: #FF0000">"id"</span><span style="color: #990000">:</span> <span style="color: #FF0000">"SearchResults"</span><span style="color: #990000">,</span>
  <span style="color: #FF0000">"required"</span><span style="color: #990000">:</span> <span style="color: #990000">[</span><span style="color: #FF0000">"count"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"results"</span><span style="color: #990000">],</span>
  <span style="color: #FF0000">"properties"</span><span style="color: #990000">:</span> <span style="color: #990000">{</span>
    <span style="color: #FF0000">"count"</span><span style="color: #990000">:</span> <span style="color: #990000">{</span>
      <span style="color: #FF0000">"type"</span><span style="color: #990000">:</span> <span style="color: #FF0000">"integer"</span>
    <span style="color: #990000">},</span>
    <span style="color: #FF0000">"results"</span><span style="color: #990000">:</span> <span style="color: #990000">{</span>
      <span style="color: #FF0000">"type"</span><span style="color: #990000">:</span> <span style="color: #FF0000">"array"</span><span style="color: #990000">,</span>
      <span style="color: #FF0000">"items"</span><span style="color: #990000">:</span> <span style="color: #990000">{</span>
        <span style="color: #FF0000">"$ref"</span><span style="color: #990000">:</span> <span style="color: #FF0000">"SearchResult"</span>
      <span style="color: #990000">}</span>
    <span style="color: #990000">}</span>
  <span style="color: #990000">}</span>
<span style="color: #990000">}</span>

SearchResult <span style="color: #990000">=</span> <span style="color: #990000">{</span>
  <span style="color: #FF0000">"id"</span><span style="color: #990000">:</span> <span style="color: #FF0000">"SearchResult"</span><span style="color: #990000">,</span>
  <span style="color: #FF0000">"required"</span><span style="color: #990000">:</span> <span style="color: #990000">[</span><span style="color: #FF0000">"name"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"rank"</span><span style="color: #990000">,</span> <span style="color: #FF0000">"link"</span><span style="color: #990000">],</span>
  <span style="color: #FF0000">"properties"</span><span style="color: #990000">:</span> <span style="color: #990000">{</span>
    <span style="color: #FF0000">"name"</span><span style="color: #990000">:</span> <span style="color: #990000">{</span>
      <span style="color: #FF0000">"type"</span><span style="color: #990000">:</span> <span style="color: #FF0000">"string"</span>
    <span style="color: #990000">},</span>
    <span style="color: #FF0000">"rank"</span><span style="color: #990000">:</span> <span style="color: #990000">{</span>
      <span style="color: #FF0000">"type"</span><span style="color: #990000">:</span> <span style="color: #FF0000">"integer"</span>
    <span style="color: #990000">},</span>
    <span style="color: #FF0000">"link"</span><span style="color: #990000">:</span> <span style="color: #990000">{</span>
      <span style="color: #FF0000">"type"</span><span style="color: #990000">:</span> <span style="color: #FF0000">"string"</span>
    <span style="color: #990000">}</span>
  <span style="color: #990000">}</span>
<span style="color: #990000">}</span></tt></pre></div></div>
</div>
<div class="sect3">
<h4 id="_supported_docstring_directives">Supported docstring directives</h4>
<div class="sect4">
<h5 id="_query">query</h5>
<div class="paragraph"><p>Defines a query string argument.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>:query &lt;argname&gt;: &lt;description&gt;

Example:
GET /foo?bar=baz

:query bar: You might specify something like baz</tt></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_form">form</h5>
<div class="paragraph"><p>Defines a POST application/x-www-form-urlencoded field</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>:form &lt;argname&gt;: &lt;description&gt;

Example:
POST /foo
Content-type: application/x-www-form-urlencoded

bar=baz

:form bar: You might specify something like baz</tt></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_body">body</h5>
<div class="paragraph"><p>Defines a field of a structured HTTP request body. The semantics of
the body structure are not defined. In most cases, this will provide a
reference to a JSON hash key.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>:body &lt;argname&gt;: &lt;description&gt;

Example:
POST /foo
Content-type: application/json

{"bar": "baz"}

:body bar: You might specify something like baz</tt></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_path">path</h5>
<div class="paragraph"><p>Defines a URL path part in reference to the view&#8217;s route.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>:path &lt;argname&gt;: &lt;description&gt;

Example:
@app.route('/foo/&lt;bar&gt;', methods=['GET'])
def foo(bar):
  pass

GET /foo/baz

:path bar: You might specify something like baz</tt></pre>
</div></div>
</div>
<div class="sect4">
<h5 id="_reqheader">reqheader</h5>
<div class="paragraph"><p>Defines an HTTP request header.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>:reqheader &lt;header&gt;: &lt;description&gt;

Example:
POST /foo
Authorization: OAuth token="123456"

:reqheader Authorization: Contains the authorization method, followed by a space delimited list of arguments identifying the requester</tt></pre>
</div></div>
</div>
</div>
<div class="sect3">
<h4 id="_required_arguments">Required arguments</h4>
<div class="paragraph"><p>(<a href="https://github.com/wordnik/swagger-core/wiki/Parameters">https://github.com/wordnik/swagger-core/wiki/Parameters</a>)</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>:query &lt;argname&gt;: &lt;description&gt;

Example:
:query foo: Does foo like things {"required": true}</tt></pre>
</div></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_useful_patterns">Useful Patterns</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_testing_with_clay_letting_tests_change_clay_8217_s_configuration">Testing with Clay: Letting tests change clay&#8217;s configuration</h3>
<div class="paragraph"><p>Sometimes when unittesting, it may make sense to test various configuration settings. Using
a base unittest like so:</p></div>
<div class="listingblock">
<div class="title">Base Unittest</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">CerebroTestCase</span></span><span style="color: #990000">(</span>unittest<span style="color: #990000">.</span>TestCase<span style="color: #990000">):</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__call__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Do pre-test stuff</span></span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_pre_setup</span></span><span style="color: #990000">()</span>

        unittest<span style="color: #990000">.</span>TestCase<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">__call__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> result<span style="color: #990000">)</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Do post-test stuff</span></span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_post_teardown</span></span><span style="color: #990000">()</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_pre_setup</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">pass</span></span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_post_teardown</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">pass</span></span>
</tt></pre></div></div>
<div class="paragraph"><p>Since clay&#8217;s configuration is stored as a dictionary, the trick is to use mock&#8217;s
<a href="http://www.voidspace.org.uk/python/mock/patch.html#patch-dict">patch dictionary</a>
to replace the read-only dictionary with a malleable one:</p></div>
<div class="listingblock">
<div class="title">Patched Unittest</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">CerebroTestCase</span></span><span style="color: #990000">(</span>unittest<span style="color: #990000">.</span>TestCase<span style="color: #990000">):</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__call__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-style: italic"><span style="color: #9A1900">#Copy configuration dictionary</span></span>
        self<span style="color: #990000">.</span>config_copy <span style="color: #990000">=</span> clay<span style="color: #990000">.</span>config<span style="color: #990000">.</span>CONFIG<span style="color: #990000">.</span>config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">copy</span></span><span style="color: #990000">()</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Do pre-test stuff</span></span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_pre_setup</span></span><span style="color: #990000">()</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Patch config dictionary so tests can customize</span></span>
        with mock<span style="color: #990000">.</span>patch<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">dict</span></span><span style="color: #990000">(</span>clay<span style="color: #990000">.</span>config<span style="color: #990000">.</span>CONFIG<span style="color: #990000">.</span>config<span style="color: #990000">,</span> self<span style="color: #990000">.</span>config_copy<span style="color: #990000">,</span> clear<span style="color: #990000">=</span>True<span style="color: #990000">):</span>
            unittest<span style="color: #990000">.</span>TestCase<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">__call__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> result<span style="color: #990000">)</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Do post-test stuff</span></span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_post_teardown</span></span><span style="color: #990000">()</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_pre_setup</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">pass</span></span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_post_teardown</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">pass</span></span>
</tt></pre></div></div>
<div class="paragraph"><p>Finally, you can specify an attribute on a test with a dictionary of clay.config keys
and values to be applied to each test (in the example below, it&#8217;s <tt>test_config</tt>), as
well as a utility function so that the configuration can be manipulated for a single test:</p></div>
<div class="listingblock">
<div class="title">Customizable Unittest</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">CerebroTestCase</span></span><span style="color: #990000">(</span>unittest<span style="color: #990000">.</span>TestCase<span style="color: #990000">):</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__call__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Do pre-test stuff</span></span>

        self<span style="color: #990000">.</span>config_copy <span style="color: #990000">=</span> clay<span style="color: #990000">.</span>config<span style="color: #990000">.</span>CONFIG<span style="color: #990000">.</span>config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">copy</span></span><span style="color: #990000">()</span>

        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_pre_setup</span></span><span style="color: #990000">()</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Patch config dictionary so tests can customize</span></span>
        with mock<span style="color: #990000">.</span>patch<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">dict</span></span><span style="color: #990000">(</span>clay<span style="color: #990000">.</span>config<span style="color: #990000">.</span>CONFIG<span style="color: #990000">.</span>config<span style="color: #990000">,</span> self<span style="color: #990000">.</span>config_copy<span style="color: #990000">,</span> clear<span style="color: #990000">=</span>True<span style="color: #990000">):</span>
            unittest<span style="color: #990000">.</span>TestCase<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">__call__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> result<span style="color: #990000">)</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Do post-test stuff</span></span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_post_teardown</span></span><span style="color: #990000">()</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_pre_setup</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="font-weight: bold"><span style="color: #000000">hasattr</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #FF0000">'test_config'</span><span style="color: #990000">):</span>
            <span style="font-style: italic"><span style="color: #9A1900">#Support ability for tests to have their own test settings</span></span>
            <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> attr<span style="color: #990000">,</span> value <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> self<span style="color: #990000">.</span>test_config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">items</span></span><span style="color: #990000">():</span>
                self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set_config</span></span><span style="color: #990000">(</span>attr<span style="color: #990000">,</span> value<span style="color: #990000">)</span>


    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_post_teardown</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">pass</span></span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">set_config</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> key<span style="color: #990000">,</span> value<span style="color: #990000">):</span>
<span style="font-style: italic"><span style="color: #9A1900">        """Helper function that tests can call to set config values."""</span></span>

        val <span style="color: #990000">=</span> self<span style="color: #990000">.</span>config_copy
        keys <span style="color: #990000">=</span> key<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">split</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'.'</span><span style="color: #990000">)</span>

        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> k <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> keys<span style="color: #990000">[:-</span><span style="color: #993399">1</span><span style="color: #990000">]:</span>
            val <span style="color: #990000">=</span> val<span style="color: #990000">[</span>k<span style="color: #990000">]</span>

        val<span style="color: #990000">[</span>keys<span style="color: #990000">[-</span><span style="color: #993399">1</span><span style="color: #990000">]]</span> <span style="color: #990000">=</span> value
</tt></pre></div></div>
<div class="paragraph"><p>An example test using the above patterns:</p></div>
<div class="listingblock">
<div class="title">Customizable Unittest</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">TestToast</span></span><span style="color: #990000">(</span>CerebroTestCase<span style="color: #990000">):</span>

    <span style="font-style: italic"><span style="color: #9A1900">#These values will apply to all tests in this class</span></span>
    test_config <span style="color: #990000">=</span> <span style="color: #990000">{</span>
        <span style="color: #FF0000">'toast.one_sided'</span><span style="color: #990000">:</span> False<span style="color: #990000">,</span>
        <span style="color: #FF0000">'toast.two_sided'</span><span style="color: #990000">:</span> True
    <span style="color: #990000">}</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">setUp</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">pass</span></span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">tearDown</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">pass</span></span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">test_burnt_toast</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-style: italic"><span style="color: #9A1900">#These values will apply for only this test</span></span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set_config</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'toast.one_sided'</span><span style="color: #990000">,</span> True<span style="color: #990000">)</span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set_config</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'toast.two_sided'</span><span style="color: #990000">,</span> False<span style="color: #990000">)</span>

        self<span style="color: #990000">.</span>toast <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">Toast</span></span><span style="color: #990000">()</span>
        <span style="font-style: italic"><span style="color: #9A1900">#...test continues...</span></span></tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_testing_with_clay_using_charlatan_to_manage_fixtures">Testing with Clay: Using Charlatan to manage fixtures</h3>
<div class="paragraph"><p><a href="http://uber.github.com/charlatan/">Charlatan</a> is another open sourced library from Uber for managing fixtures.
The following patterns provide a way to integrate the charlatan fixture model into a unittesting framework.</p></div>
<div class="paragraph"><p>First add a filepath to your fixtures to your configuration file:
.Fixture configuration</p></div>
<div class="listingblock">
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">{</span>
    <span style="color: #FF0000">"testing"</span><span style="color: #990000">:</span> <span style="color: #FF0000">{</span>
        <span style="color: #FF0000">"fixture_filepath"</span><span style="color: #990000">:</span>  <span style="color: #FF0000">"cerebro/tests/fixtures.yaml"</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Charlatan only needs to load the fixtures once, so it makes sense to do it when the package is setup.
Adding this to the setup_package() method in the project&#8217;s test/<em>init</em>.py accomplishes this when using nosetests.
The following is an example from Uber&#8217;s Cerebro project:</p></div>
<div class="listingblock">
<div class="title"><tt>test/__init__.py</tt></div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">from</span></span> __future__ <span style="font-weight: bold"><span style="color: #000080">import</span></span> absolute_import
<span style="font-weight: bold"><span style="color: #000080">import</span></span> charlatan
<span style="font-weight: bold"><span style="color: #000080">import</span></span> os
<span style="font-weight: bold"><span style="color: #000080">import</span></span> clay

<span style="font-style: italic"><span style="color: #9A1900">#Get project path</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> os<span style="color: #990000">.</span>environ<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"CEREBRO_HOME"</span><span style="color: #990000">):</span>
    <span style="font-style: italic"><span style="color: #9A1900">#Get absolute project path from environmental variables</span></span>
    CEREBRO_PATH <span style="color: #990000">=</span> os<span style="color: #990000">.</span>path<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">join</span></span><span style="color: #990000">(</span>os<span style="color: #990000">.</span>environ<span style="color: #990000">[</span><span style="color: #FF0000">"CEREBRO_HOME"</span><span style="color: #990000">],</span> <span style="color: #FF0000">"cerebro"</span><span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #0000FF">else</span></span><span style="color: #990000">:</span>
    <span style="font-style: italic"><span style="color: #9A1900">#Get project path from relative path</span></span>
    CEREBRO_PATH <span style="color: #990000">=</span> os<span style="color: #990000">.</span>path<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">normpath</span></span><span style="color: #990000">(</span>os<span style="color: #990000">.</span>path<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">abspath</span></span><span style="color: #990000">(</span>__file__<span style="color: #990000">)</span> <span style="color: #990000">+</span> <span style="color: #FF0000">"../../../.."</span><span style="color: #990000">)</span>


<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">setup_package</span></span><span style="color: #990000">():</span>
<span style="font-style: italic"><span style="color: #9A1900">    """Set up the environment for the whole test package.</span></span>

<span style="font-style: italic"><span style="color: #9A1900">    Put here all the configuration that needs to be run only once.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">    """</span></span>

    <span style="font-style: italic"><span style="color: #9A1900">#Import fixtures</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> clay<span style="color: #990000">.</span>config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'testing.fixture_filepath'</span><span style="color: #990000">):</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Get fixture filepath</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="font-weight: bold"><span style="color: #000000">str</span></span><span style="color: #990000">(</span>CEREBRO_PATH<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="font-weight: bold"><span style="color: #000000">str</span></span><span style="color: #990000">(</span>clay<span style="color: #990000">.</span>config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'testing.fixture_filepath'</span><span style="color: #990000">)):</span>
            fixtures_filepath <span style="color: #990000">=</span> os<span style="color: #990000">.</span>path<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">join</span></span><span style="color: #990000">(</span>CEREBRO_PATH<span style="color: #990000">,</span> clay<span style="color: #990000">.</span>config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'testing.fixture_filepath'</span><span style="color: #990000">))</span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span><span style="color: #990000">:</span>
            fixtures_filepath <span style="color: #990000">=</span> clay<span style="color: #990000">.</span>config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'testing.fixture_filepath'</span><span style="color: #990000">)</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Load fixtures</span></span>
        charlatan<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">load</span></span><span style="color: #990000">(</span>fixtures_filepath<span style="color: #990000">,</span>
                models_package<span style="color: #990000">=</span><span style="color: #FF0000">"cerebro.model"</span><span style="color: #990000">,</span>
                db_session<span style="color: #990000">=</span>db_session<span style="color: #990000">)</span>  <span style="font-style: italic"><span style="color: #9A1900"># db_session is a sqlalchemy Session object, for saving fixtures</span></span>

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">teardown_package</span></span><span style="color: #990000">():</span>
    <span style="font-weight: bold"><span style="color: #0000FF">pass</span></span></tt></pre></div></div>
<div class="paragraph"><p>Once the fixtures have been loaded, add charlatan&#8217;s FixturesManagerMixin to your testcase to allow each test to access and manipulate fixtures. Generally, it saves time if each test can optionally specify a list of fixtures to be installed before each test; adding a few lines to <tt>_pre_setup</tt> takes care of the installation.</p></div>
<div class="listingblock">
<div class="title">Fixture Test</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">CerebroTestCase</span></span><span style="color: #990000">(</span>unittest<span style="color: #990000">.</span>TestCase<span style="color: #990000">,</span> charlatan<span style="color: #990000">.</span>FixturesManagerMixin<span style="color: #990000">):</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__call__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Do pre-test stuff</span></span>

        self<span style="color: #990000">.</span>config_copy <span style="color: #990000">=</span> clay<span style="color: #990000">.</span>config<span style="color: #990000">.</span>CONFIG<span style="color: #990000">.</span>config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">copy</span></span><span style="color: #990000">()</span>

        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_pre_setup</span></span><span style="color: #990000">()</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Patch config dictionary so tests can customize</span></span>
        with mock<span style="color: #990000">.</span>patch<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">dict</span></span><span style="color: #990000">(</span>clay<span style="color: #990000">.</span>config<span style="color: #990000">.</span>CONFIG<span style="color: #990000">.</span>config<span style="color: #990000">,</span> self<span style="color: #990000">.</span>config_copy<span style="color: #990000">,</span> clear<span style="color: #990000">=</span>True<span style="color: #990000">):</span>
            unittest<span style="color: #990000">.</span>TestCase<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">__call__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> result<span style="color: #990000">)</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Do post-test stuff</span></span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_post_teardown</span></span><span style="color: #990000">()</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_pre_setup</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>

        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">clean_fixtures_cache</span></span><span style="color: #990000">()</span>

        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="font-weight: bold"><span style="color: #000000">hasattr</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #FF0000">'test_config'</span><span style="color: #990000">):</span>
            <span style="font-style: italic"><span style="color: #9A1900">#Support ability for tests to have their own test settings</span></span>
            <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> attr<span style="color: #990000">,</span> value <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> self<span style="color: #990000">.</span>test_config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">items</span></span><span style="color: #990000">():</span>
                self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set_config</span></span><span style="color: #990000">(</span>attr<span style="color: #990000">,</span> value<span style="color: #990000">)</span>

        <span style="font-style: italic"><span style="color: #9A1900">#install class fixtures</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="font-weight: bold"><span style="color: #000000">hasattr</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #FF0000">'fixtures'</span><span style="color: #990000">):</span>
            self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">install_fixtures</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>fixtures<span style="color: #990000">)</span>


    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_post_teardown</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">clean_fixtures_cache</span></span><span style="color: #990000">()</span>


    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">set_config</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> key<span style="color: #990000">,</span> value<span style="color: #990000">):</span>
<span style="font-style: italic"><span style="color: #9A1900">        """Helper function that tests can call to set config values."""</span></span>

        val <span style="color: #990000">=</span> self<span style="color: #990000">.</span>config_copy
        keys <span style="color: #990000">=</span> key<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">split</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'.'</span><span style="color: #990000">)</span>

        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> k <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> keys<span style="color: #990000">[:-</span><span style="color: #993399">1</span><span style="color: #990000">]:</span>
            val <span style="color: #990000">=</span> val<span style="color: #990000">[</span>k<span style="color: #990000">]</span>

        val<span style="color: #990000">[</span>keys<span style="color: #990000">[-</span><span style="color: #993399">1</span><span style="color: #990000">]]</span> <span style="color: #990000">=</span> value</tt></pre></div></div>
<div class="paragraph"><p>Additionally, the full charlatan functionality is available in each unit test:</p></div>
<div class="listingblock">
<div class="title">Fixture Unittest</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">TestToast</span></span><span style="color: #990000">(</span>CerebroTestCase<span style="color: #990000">):</span>

    <span style="font-style: italic"><span style="color: #9A1900">#These fixtures will be installed with all tests</span></span>
    fixtures <span style="color: #990000">=</span> <span style="color: #990000">(</span><span style="color: #FF0000">'toast'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'burnt_toast'</span><span style="color: #990000">,</span> <span style="color: #FF0000">'bread'</span><span style="color: #990000">)</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">setUp</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">pass</span></span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">tearDown</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #0000FF">pass</span></span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">test_toastiness</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        is_burnt <span style="color: #990000">=</span> self<span style="color: #990000">.</span>toast<span style="color: #990000">.</span>burnt  <span style="font-style: italic"><span style="color: #9A1900"># installed fixtures can be accessed</span></span>

        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">install_fixture</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'wheat_bread'</span><span style="color: #990000">)</span>  <span style="font-style: italic"><span style="color: #9A1900"># installs wheat_bread fixture for just this test.</span></span>

        toaster <span style="color: #990000">=</span> self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get_fixture</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'toaster'</span><span style="color: #990000">)</span>  <span style="font-style: italic"><span style="color: #9A1900"># can get fixtures manipulate them</span></span>

        toaster<span style="color: #990000">.</span>num_slots <span style="color: #990000">=</span> <span style="color: #993399">4</span>
        toaster<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">save</span></span><span style="color: #990000">()</span>

        <span style="font-style: italic"><span style="color: #9A1900">#...test continues</span></span>
</tt></pre></div></div>
</div>
<div class="sect2">
<h3 id="_testing_with_clay_providing_a_clean_test_database_for_each_test">Testing with Clay: Providing a clean test database for each test</h3>
<div class="paragraph"><p>When testing, its wise to provide each test with a database containing the correct schema, but no actual data, allowing each test to manipulate the database as necessary. This pattern involves leveraging the transaction capability of sqlalchemy&#8217;s <a href="http://docs.sqlalchemy.org/en/latest/orm/session.html#sqlalchemy.orm.scoping.scoped_session"><tt>scoped_session</tt></a> to accopmlish this goal.</p></div>
<div class="paragraph"><p>First, add a sqlalchemy configuration for your test database to clay&#8217;s configuration file:</p></div>
<div class="listingblock">
<div class="title">Test database configuration</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="color: #FF0000">{</span>
    <span style="color: #FF0000">"testing"</span><span style="color: #990000">:</span> <span style="color: #FF0000">{</span>
        <span style="color: #FF0000">"fixture_filepath"</span><span style="color: #990000">:</span>  <span style="color: #FF0000">"cerebro/tests/fixtures.yaml"</span><span style="color: #990000">,</span>
        <span style="color: #FF0000">"database"</span><span style="color: #990000">:</span> <span style="color: #FF0000">{</span>
            <span style="color: #FF0000">"sqlalchemy.url"</span><span style="color: #990000">:</span> <span style="color: #FF0000">"postgresql://user:password@localhost:1234/test_database"</span><span style="color: #990000">,</span>
            <span style="color: #FF0000">"echo"</span><span style="color: #990000">:</span> True
        <span style="color: #FF0000">}</span>
    <span style="color: #FF0000">}</span>
<span style="color: #FF0000">}</span></tt></pre></div></div>
<div class="paragraph"><p>Then, have the engine start when the test package is started by adding to the setup_package() function started here. The following is an example from Uber&#8217;s Cerebro project:</p></div>
<div class="listingblock">
<div class="title"><tt>test/__init__.py</tt> with Test Database Engine</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #000080">from</span></span> __future__ <span style="font-weight: bold"><span style="color: #000080">import</span></span> absolute_import
<span style="font-weight: bold"><span style="color: #000080">import</span></span> charlatan
<span style="font-weight: bold"><span style="color: #000080">import</span></span> os
<span style="font-weight: bold"><span style="color: #000080">import</span></span> clay

<span style="font-weight: bold"><span style="color: #000080">from</span></span> sqlalchemy <span style="font-weight: bold"><span style="color: #000080">import</span></span> engine_from_config

<span style="font-style: italic"><span style="color: #9A1900">#db_session is a sqlalchemy scoped_session object</span></span>
<span style="font-style: italic"><span style="color: #9A1900">#initialize_sql is a function to import Cerebro's models and initialize the sqlalchemy mappers</span></span>
<span style="font-weight: bold"><span style="color: #000080">from</span></span> cerebro<span style="color: #990000">.</span>model<span style="color: #990000">.</span>basics <span style="font-weight: bold"><span style="color: #000080">import</span></span> db_session<span style="color: #990000">,</span> initialize_sql


test_engine <span style="color: #990000">=</span> None

<span style="font-style: italic"><span style="color: #9A1900">#Get project path</span></span>
<span style="font-weight: bold"><span style="color: #0000FF">if</span></span> os<span style="color: #990000">.</span>environ<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">"CEREBRO_HOME"</span><span style="color: #990000">):</span>
    <span style="font-style: italic"><span style="color: #9A1900">#Get absolute project path from environmental variables</span></span>
    CEREBRO_PATH <span style="color: #990000">=</span> os<span style="color: #990000">.</span>path<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">join</span></span><span style="color: #990000">(</span>os<span style="color: #990000">.</span>environ<span style="color: #990000">[</span><span style="color: #FF0000">"CEREBRO_HOME"</span><span style="color: #990000">],</span> <span style="color: #FF0000">"cerebro"</span><span style="color: #990000">)</span>
<span style="font-weight: bold"><span style="color: #0000FF">else</span></span><span style="color: #990000">:</span>
    <span style="font-style: italic"><span style="color: #9A1900">#Get project path from relative path</span></span>
    CEREBRO_PATH <span style="color: #990000">=</span> os<span style="color: #990000">.</span>path<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">normpath</span></span><span style="color: #990000">(</span>os<span style="color: #990000">.</span>path<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">abspath</span></span><span style="color: #990000">(</span>__file__<span style="color: #990000">)</span> <span style="color: #990000">+</span> <span style="color: #FF0000">"../../../.."</span><span style="color: #990000">)</span>


<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">setup_package</span></span><span style="color: #990000">():</span>
<span style="font-style: italic"><span style="color: #9A1900">    """Set up the environment for the whole test package.</span></span>

<span style="font-style: italic"><span style="color: #9A1900">    Put here all the configuration that needs to be run only once.</span></span>
<span style="font-style: italic"><span style="color: #9A1900">    """</span></span>

    <span style="font-style: italic"><span style="color: #9A1900">#Start test engine</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">global</span></span> test_engine

    test_engine <span style="color: #990000">=</span> <span style="font-weight: bold"><span style="color: #000000">engine_from_config</span></span><span style="color: #990000">(</span>clay<span style="color: #990000">.</span>config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'testing.database'</span><span style="color: #990000">))</span>

    <span style="font-style: italic"><span style="color: #9A1900">#Import fixtures</span></span>
    <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> clay<span style="color: #990000">.</span>config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'testing.fixture_filepath'</span><span style="color: #990000">):</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Get fixture filepath</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="font-weight: bold"><span style="color: #000000">str</span></span><span style="color: #990000">(</span>CEREBRO_PATH<span style="color: #990000">)</span> <span style="font-weight: bold"><span style="color: #0000FF">not</span></span> <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> <span style="font-weight: bold"><span style="color: #000000">str</span></span><span style="color: #990000">(</span>clay<span style="color: #990000">.</span>config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'testing.fixture_filepath'</span><span style="color: #990000">)):</span>
            fixtures_filepath <span style="color: #990000">=</span> os<span style="color: #990000">.</span>path<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">join</span></span><span style="color: #990000">(</span>CEREBRO_PATH<span style="color: #990000">,</span> clay<span style="color: #990000">.</span>config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'testing.fixture_filepath'</span><span style="color: #990000">))</span>
        <span style="font-weight: bold"><span style="color: #0000FF">else</span></span><span style="color: #990000">:</span>
            fixtures_filepath <span style="color: #990000">=</span> clay<span style="color: #990000">.</span>config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">get</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'testing.fixture_filepath'</span><span style="color: #990000">)</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Load fixtures</span></span>
        charlatan<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">load</span></span><span style="color: #990000">(</span>fixtures_filepath<span style="color: #990000">,</span>
                models_package<span style="color: #990000">=</span><span style="color: #FF0000">"cerebro.model"</span><span style="color: #990000">,</span>
                db_session<span style="color: #990000">=</span>db_session<span style="color: #990000">)</span>  <span style="font-style: italic"><span style="color: #9A1900"># db_session is a sqlalchemy Session object, for saving fixtures</span></span>

    <span style="font-style: italic"><span style="color: #9A1900">#Initialize SQLalchemy mappers with test engine</span></span>
    <span style="font-weight: bold"><span style="color: #000000">initialize_sql</span></span><span style="color: #990000">(</span>test_engine<span style="color: #990000">)</span>

<span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">teardown_package</span></span><span style="color: #990000">():</span>
    <span style="font-weight: bold"><span style="color: #0000FF">pass</span></span>
</tt></pre></div></div>
<div class="paragraph"><p>Each test will open its own connection and transaction with the database, and as part of the teardown the entire transaction will be rolled back, effectively giving each test its own copy of the database to interact with. Continuing to add to our base CerebroTestCase class, we add this logic in the <tt>_pre_setup</tt> and <tt>post_teardown</tt> methods:</p></div>
<div class="listingblock">
<div class="title">Test Database Test</div>
<div class="content"><!-- Generator: GNU source-highlight 3.1.5
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><span style="font-weight: bold"><span style="color: #0000FF">class</span></span> <span style="font-weight: bold"><span style="color: #000000">CerebroTestCase</span></span><span style="color: #990000">(</span>unittest<span style="color: #990000">.</span>TestCase<span style="color: #990000">,</span> charlatan<span style="color: #990000">.</span>FixturesManagerMixin<span style="color: #990000">):</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">__call__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Do pre-test stuff</span></span>

        self<span style="color: #990000">.</span>config_copy <span style="color: #990000">=</span> clay<span style="color: #990000">.</span>config<span style="color: #990000">.</span>CONFIG<span style="color: #990000">.</span>config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">copy</span></span><span style="color: #990000">()</span>

        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_pre_setup</span></span><span style="color: #990000">()</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Patch config dictionary so tests can customize</span></span>
        with mock<span style="color: #990000">.</span>patch<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">dict</span></span><span style="color: #990000">(</span>clay<span style="color: #990000">.</span>config<span style="color: #990000">.</span>CONFIG<span style="color: #990000">.</span>config<span style="color: #990000">,</span> self<span style="color: #990000">.</span>config_copy<span style="color: #990000">,</span> clear<span style="color: #990000">=</span>True<span style="color: #990000">):</span>
            unittest<span style="color: #990000">.</span>TestCase<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">__call__</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> result<span style="color: #990000">)</span>

        <span style="font-style: italic"><span style="color: #9A1900">#Do post-test stuff</span></span>
        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">_post_teardown</span></span><span style="color: #990000">()</span>

    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_pre_setup</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-weight: bold"><span style="color: #000080">from</span></span> cerebro<span style="color: #990000">.</span>tests <span style="font-weight: bold"><span style="color: #000080">import</span></span> test_engine as engine

        <span style="font-style: italic"><span style="color: #9A1900"># Start a new connection</span></span>
        self<span style="color: #990000">.</span>connection <span style="color: #990000">=</span> engine<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">connect</span></span><span style="color: #990000">()</span>

        <span style="font-style: italic"><span style="color: #9A1900"># Begin a non-ORM transaction</span></span>
        self<span style="color: #990000">.</span>trans <span style="color: #990000">=</span> self<span style="color: #990000">.</span>connection<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">begin</span></span><span style="color: #990000">()</span>
        <span style="font-style: italic"><span style="color: #9A1900"># Bind the session to the connection</span></span>
        db_session<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">configure</span></span><span style="color: #990000">(</span>bind<span style="color: #990000">=</span>self<span style="color: #990000">.</span>connection<span style="color: #990000">)</span>

        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">clean_fixtures_cache</span></span><span style="color: #990000">()</span>

        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="font-weight: bold"><span style="color: #000000">hasattr</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #FF0000">'test_config'</span><span style="color: #990000">):</span>
            <span style="font-style: italic"><span style="color: #9A1900">#Support ability for tests to have their own test settings</span></span>
            <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> attr<span style="color: #990000">,</span> value <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> self<span style="color: #990000">.</span>test_config<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">items</span></span><span style="color: #990000">():</span>
                self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">set_config</span></span><span style="color: #990000">(</span>attr<span style="color: #990000">,</span> value<span style="color: #990000">)</span>

        <span style="font-style: italic"><span style="color: #9A1900">#install class fixtures</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="font-weight: bold"><span style="color: #000000">hasattr</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #FF0000">'fixtures'</span><span style="color: #990000">):</span>
            self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">install_fixtures</span></span><span style="color: #990000">(</span>self<span style="color: #990000">.</span>fixtures<span style="color: #990000">)</span>


    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">_post_teardown</span></span><span style="color: #990000">(</span>self<span style="color: #990000">):</span>
        <span style="font-style: italic"><span style="color: #9A1900"># Teardown the transaction</span></span>
        <span style="font-weight: bold"><span style="color: #0000FF">if</span></span> <span style="font-weight: bold"><span style="color: #000000">hasattr</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> <span style="color: #FF0000">"connection"</span><span style="color: #990000">):</span>
            <span style="font-style: italic"><span style="color: #9A1900"># Rollback database</span></span>
            self<span style="color: #990000">.</span>trans<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">rollback</span></span><span style="color: #990000">()</span>
            db_session<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">remove</span></span><span style="color: #990000">()</span>
            <span style="font-style: italic"><span style="color: #9A1900"># We have to explicitely close the connection</span></span>
            self<span style="color: #990000">.</span>connection<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">close</span></span><span style="color: #990000">()</span>
            <span style="font-weight: bold"><span style="color: #0000FF">del</span></span> self<span style="color: #990000">.</span>connection

        self<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">clean_fixtures_cache</span></span><span style="color: #990000">()</span>


    <span style="font-weight: bold"><span style="color: #0000FF">def</span></span> <span style="font-weight: bold"><span style="color: #000000">set_config</span></span><span style="color: #990000">(</span>self<span style="color: #990000">,</span> key<span style="color: #990000">,</span> value<span style="color: #990000">):</span>
<span style="font-style: italic"><span style="color: #9A1900">        """Helper function that tests can call to set config values."""</span></span>

        val <span style="color: #990000">=</span> self<span style="color: #990000">.</span>config_copy
        keys <span style="color: #990000">=</span> key<span style="color: #990000">.</span><span style="font-weight: bold"><span style="color: #000000">split</span></span><span style="color: #990000">(</span><span style="color: #FF0000">'.'</span><span style="color: #990000">)</span>

        <span style="font-weight: bold"><span style="color: #0000FF">for</span></span> k <span style="font-weight: bold"><span style="color: #0000FF">in</span></span> keys<span style="color: #990000">[:-</span><span style="color: #993399">1</span><span style="color: #990000">]:</span>
            val <span style="color: #990000">=</span> val<span style="color: #990000">[</span>k<span style="color: #990000">]</span>

        val<span style="color: #990000">[</span>keys<span style="color: #990000">[-</span><span style="color: #993399">1</span><span style="color: #990000">]]</span> <span style="color: #990000">=</span> value</tt></pre></div></div>
<div class="paragraph"><p>Important Note: This pattern can not be used for any methods with explicitly roll back a sqlalchemy session, as it will cascade downward and rollback the test&#8217;s transaction.</p></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_changes_in_2_0_0">Changes in 2.0.0</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_package_version_is_now_semantic">Package version is now semantic</h3>
<div class="paragraph"><p>This release, and all future releases of Clay, will adhere to the
versioning scheme described at <a href="http://semver.org/">http://semver.org/</a></p></div>
<div class="paragraph"><p>In summary, the major version will be incremented for backwards
incompatible changes, the minor version will be incremented for feature
releases containing backwards compatible changes, and the patch
version will be incremented for bugfix releases.</p></div>
</div>
<div class="sect2">
<h3 id="_clay_environment_is_deprecated">CLAY_ENVIRONMENT is deprecated</h3>
<div class="paragraph"><p>The <tt>CLAY_ENVIRONMENT</tt> variable should no longer be used to
differentiate production and development environments, but you should
rather use separate files passed to <tt>CLAY_CONFIG</tt> for this purpose.</p></div>
</div>
<div class="sect2">
<h3 id="_debug_flags_are_no_longer_environment_based">Debug flags are no longer environment based</h3>
<div class="paragraph"><p>In previous releases, if <tt>CLAY_ENVIRONMENT=development</tt> was specified,
logging and devserver configuration behaved differently. This check
has been replaced with the <tt>debug.enabled</tt> boolean flag, which
defaults to false. You will generally want this enabled in your
development configuration.</p></div>
<div class="paragraph"><p>An additional <tt>debug.logging</tt> boolean has been added that sets the
default log level of logger instances returned from
<tt>clay.config.get_logger()</tt> to DEBUG, rather than INFO.</p></div>
</div>
<div class="sect2">
<h3 id="_default_logging_configuration">Default logging configuration</h3>
<div class="paragraph"><p>Clay now supports arbitrary logging configuration by setting a
<tt>logging</tt> key in your configuration, with contents adhering to the
<a href="http://docs.python.org/2/library/logging.config.html#logging-config-dictschema">dictConfig
schema</a> specified by the Python standard library.</p></div>
<div class="paragraph"><p>If no <tt>logging</tt> element is found in your configuration, Clay will
default to logging all messages to stderr at the WARNING level or
above.</p></div>
</div>
<div class="sect2">
<h3 id="_remote_logging_is_not_automatic">Remote logging is not automatic</h3>
<div class="paragraph"><p>In previous releases, if <tt>logging.host</tt> were specified in the config,
a <tt>clay.logger.UDPHandler</tt> was initialized and all log messages were
directed to that host. This option is no longer available, and the
UDPHandler must be initialized using a dictConfig.</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>logging:
  version: 1
  handlers:
    remote:
      class: clay.logger.UDPHandler
      level: DEBUG
      host: logs.example.com
      port: 22000
  loggers:
    root:
      level: DEBUG
      handlers: remote</tt></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_flask_init_is_no_longer_required">flask.init is no longer required</h3>
<div class="paragraph"><p>The <tt>flask.init.import_name</tt> configuration option is now optional. If
not specified, the import_name defaults to <tt>clayapp</tt>.</p></div>
</div>
<div class="sect2">
<h3 id="_clay_now_includes_unit_tests">Clay now includes unit tests</h3>
<div class="paragraph"><p>The clay framework now has internal tests that may be run with
<tt>python setup.py test</tt>. These tests are contained in the tests/
directory at the top level of the project and utilize the
(<a href="http://webtest.pythonpaste.org/en/latest/index.html)">webtest
library</a>.</p></div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Version 2.0.5<br />
Last updated 2013-10-24 20:07:22 UTC
</div>
</div>
</body>
</html>
